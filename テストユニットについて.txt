# ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
test/
â”œâ”€â”€ unit/                          # å˜ä½“ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ puzzle_piece_test.dart
â”‚   â”‚   â””â”€â”€ game_state_test.dart
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ puzzle_generator_test.dart
â”‚   â”‚   â”œâ”€â”€ admob_service_test.dart
â”‚   â”‚   â””â”€â”€ audio_service_test.dart
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ performance_monitor_test.dart
â”‚       â””â”€â”€ error_handler_test.dart
â”œâ”€â”€ widget/                        # ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ home_screen_test.dart
â”‚   â”‚   â”œâ”€â”€ game_screen_test.dart
â”‚   â”‚   â””â”€â”€ settings_screen_test.dart
â”‚   â””â”€â”€ widgets/
â”‚       â”œâ”€â”€ game_board_widget_test.dart
â”‚       â””â”€â”€ piece_tray_widget_test.dart
â”œâ”€â”€ integration/                   # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ app_test.dart
â”‚   â”œâ”€â”€ game_flow_test.dart
â”‚   â””â”€â”€ settings_flow_test.dart
â””â”€â”€ test_helpers/                  # ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼
    â”œâ”€â”€ mock_data.dart
    â”œâ”€â”€ test_utils.dart
    â””â”€â”€ widget_tester_extensions.dart

---

# test/unit/models/puzzle_piece_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:flutter/material.dart';
import 'package:brain_blocks/models/puzzle_piece.dart';

void main() {
  group('PuzzlePiece Tests', () {
    test('PiecePosition should calculate correctly', () {
      const pos1 = PiecePosition(2, 3);
      const pos2 = PiecePosition(1, 1);
      
      final result = pos1 + pos2;
      
      expect(result.x, equals(3));
      expect(result.y, equals(4));
    });

    test('PiecePosition rotation should work correctly', () {
      const pos = PiecePosition(1, 0);
      final rotated = pos.rotate();
      
      expect(rotated.x, equals(0));
      expect(rotated.y, equals(1));
    });

    test('PuzzlePiece should create correctly', () {
      final piece = PuzzlePiece(
        id: 'test-piece',
        cells: const [
          PiecePosition(0, 0),
          PiecePosition(1, 0),
          PiecePosition(0, 1),
        ],
        color: Colors.blue,
      );

      expect(piece.id, equals('test-piece'));
      expect(piece.cells.length, equals(3));
      expect(piece.color, equals(Colors.blue));
      expect(piece.isPlaced, isFalse);
    });

    test('PuzzlePiece rotation should work correctly', () {
      final piece = PuzzlePiece(
        id: 'test-piece',
        cells: const [
          PiecePosition(0, 0),
          PiecePosition(1, 0),
        ],
        color: Colors.blue,
        rotation: 1,
      );

      final rotatedCells = piece.getRotatedCells();
      
      expect(rotatedCells[0], equals(const PiecePosition(0, 0)));
      expect(rotatedCells[1], equals(const PiecePosition(0, 1)));
    });

    test('PuzzlePiece board cells should calculate correctly', () {
      final piece = PuzzlePiece(
        id: 'test-piece',
        cells: const [
          PiecePosition(0, 0),
          PiecePosition(1, 0),
        ],
        color: Colors.blue,
        boardPosition: const PiecePosition(2, 3),
      );

      final boardCells = piece.getBoardCells();
      
      expect(boardCells[0], equals(const PiecePosition(2, 3)));
      expect(boardCells[1], equals(const PiecePosition(3, 3)));
    });
  });
}

---

# test/unit/services/puzzle_generator_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:brain_blocks/services/puzzle_generator.dart';

void main() {
  group('PuzzleGenerator Tests', () {
    test('should generate correct number of pieces for 5x5 grid', () {
      final pieces = PuzzleGenerator.generatePuzzle(gridSize: 5);
      
      expect(pieces, isNotEmpty);
      expect(pieces.length, greaterThan(0));
      expect(pieces.length, lessThan(25)); // æœ€å¤§25å€‹ï¼ˆå…¨ã¦1ã‚»ãƒ«ï¼‰
      
      // å…¨ãƒ”ãƒ¼ã‚¹ã®ã‚»ãƒ«æ•°ã®åˆè¨ˆãŒ25ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
      final totalCells = pieces
          .map((p) => p.cells.length)
          .reduce((a, b) => a + b);
      expect(totalCells, equals(25));
    });

    test('should generate pieces with valid colors', () {
      final pieces = PuzzleGenerator.generatePuzzle(gridSize: 5);
      
      for (final piece in pieces) {
        expect(piece.color, isNotNull);
        expect(piece.id, isNotEmpty);
      }
    });

    test('should generate pieces with 2-6 cells each', () {
      final pieces = PuzzleGenerator.generatePuzzle(gridSize: 7);
      
      for (final piece in pieces) {
        expect(piece.cells.length, greaterThanOrEqualTo(2));
        expect(piece.cells.length, lessThanOrEqualTo(6));
      }
    });

    test('generated pieces should have relative coordinates', () {
      final pieces = PuzzleGenerator.generatePuzzle(gridSize: 5);
      
      for (final piece in pieces) {
        // æœ€å°åº§æ¨™ãŒ(0,0)ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
        final minX = piece.cells.map((c) => c.x).reduce((a, b) => a < b ? a : b);
        final minY = piece.cells.map((c) => c.y).reduce((a, b) => a < b ? a : b);
        
        expect(minX, equals(0));
        expect(minY, equals(0));
      }
    });

    test('should generate different puzzles with different seeds', () {
      final pieces1 = PuzzleGenerator.generatePuzzle(gridSize: 5, seed: 123);
      final pieces2 = PuzzleGenerator.generatePuzzle(gridSize: 5, seed: 456);
      
      // ç•°ãªã‚‹çµæœãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆç¢ºç‡çš„ãƒ†ã‚¹ãƒˆï¼‰
      bool isDifferent = false;
      if (pieces1.length != pieces2.length) {
        isDifferent = true;
      } else {
        for (int i = 0; i < pieces1.length; i++) {
          if (pieces1[i].cells.length != pieces2[i].cells.length) {
            isDifferent = true;
            break;
          }
        }
      }
      
      expect(isDifferent, isTrue);
    });
  });
}

---

# test/widget/screens/home_screen_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:brain_blocks/screens/home_screen.dart';
import 'package:brain_blocks/services/storage_service.dart';
import '../../test_helpers/test_utils.dart';

void main() {
  group('HomeScreen Widget Tests', () {
    late ProviderContainer container;

    setUp(() async {
      await TestUtils.setupTestEnvironment();
      container = ProviderContainer();
    });

    tearDown(() {
      container.dispose();
    });

    testWidgets('should display app title and main buttons', (tester) async {
      await tester.pumpWidget(
        UncontrolledProviderScope(
          container: container,
          child: const MaterialApp(
            home: HomeScreen(),
          ),
        ),
      );

      // ã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒˆãƒ«ã®ç¢ºèª
      expect(find.text('ãƒ–ãƒ¬ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã‚¹'), findsOneWidget);
      
      // ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ç¢ºèª
      expect(find.text('ã‚²ãƒ¼ãƒ é–‹å§‹'), findsOneWidget);
      expect(find.text('è¨­å®š'), findsOneWidget);
      expect(find.text('ãƒ˜ãƒ«ãƒ—'), findsOneWidget);
    });

    testWidgets('should navigate to level select when game start is tapped', (tester) async {
      await tester.pumpWidget(
        UncontrolledProviderScope(
          container: container,
          child: MaterialApp(
            home: const HomeScreen(),
            routes: {
              '/level_select': (context) => const Scaffold(
                body: Text('Level Select Screen'),
              ),
            },
          ),
        ),
      );

      await tester.tap(find.text('ã‚²ãƒ¼ãƒ é–‹å§‹'));
      await tester.pumpAndSettle();

      expect(find.text('Level Select Screen'), findsOneWidget);
    });

    testWidgets('should show stats card with correct information', (tester) async {
      await tester.pumpWidget(
        UncontrolledProviderScope(
          container: container,
          child: const MaterialApp(
            home: HomeScreen(),
          ),
        ),
      );

      // çµ±è¨ˆæƒ…å ±ã‚«ãƒ¼ãƒ‰ã®ç¢ºèª
      expect(find.text('çµ±è¨ˆæƒ…å ±'), findsOneWidget);
      expect(find.text('ç·ãƒ—ãƒ¬ã‚¤å›æ•°'), findsOneWidget);
      expect(find.text('ã‚¯ãƒªã‚¢ç‡'), findsOneWidget);
    });
  });
}

---

# test/widget/widgets/game_board_widget_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:brain_blocks/widgets/game_board_widget.dart';
import 'package:brain_blocks/models/game_state.dart';
import 'package:brain_blocks/models/puzzle_piece.dart';
import 'package:brain_blocks/services/puzzle_generator.dart';
import '../../test_helpers/mock_data.dart';

void main() {
  group('GameBoardWidget Tests', () {
    testWidgets('should render game board correctly', (tester) async {
      final gameState = MockData.createMockGameState();

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: GameBoardWidget(
              gameState: gameState,
              onPiecePlaced: (pieceId, position) {},
            ),
          ),
        ),
      );

      // ã‚²ãƒ¼ãƒ ç›¤é¢ãŒæç”»ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.byType(CustomPaint), findsAtLeastNWidgets(1));
    });

    testWidgets('should handle piece drag and drop', (tester) async {
      final gameState = MockData.createMockGameState();
      String? placedPieceId;
      PiecePosition? placedPosition;

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: GameBoardWidget(
              gameState: gameState,
              onPiecePlaced: (pieceId, position) {
                placedPieceId = pieceId;
                placedPosition = position;
              },
            ),
          ),
        ),
      );

      // DragTargetãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.byType(DragTarget<String>), findsOneWidget);
    });

    testWidgets('should show hint when hintPieceId is provided', (tester) async {
      final gameState = MockData.createMockGameState();
      final animationController = AnimationController(
        duration: const Duration(seconds: 1),
        vsync: const TestVSync(),
      );

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: GameBoardWidget(
              gameState: gameState,
              hintPieceId: gameState.pieces.first.id,
              hintAnimation: animationController,
              onPiecePlaced: (pieceId, position) {},
            ),
          ),
        ),
      );

      // ãƒ’ãƒ³ãƒˆè¡¨ç¤ºç”¨ã®CustomPaintãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.byType(CustomPaint), findsAtLeastNWidgets(2));
    });
  });
}

---

# test/integration/game_flow_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';
import 'package:brain_blocks/main.dart' as app;
import 'package:brain_blocks/services/storage_service.dart';

void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  group('Game Flow Integration Tests', () {
    testWidgets('complete game flow from start to finish', (tester) async {
      // ã‚¢ãƒ—ãƒªèµ·å‹•
      await StorageService.init();
      app.main();
      await tester.pumpAndSettle();

      // ãƒ›ãƒ¼ãƒ ç”»é¢ã®ç¢ºèª
      expect(find.text('ãƒ–ãƒ¬ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã‚¹'), findsOneWidget);

      // ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
      await tester.tap(find.text('ã‚²ãƒ¼ãƒ é–‹å§‹'));
      await tester.pumpAndSettle();

      // ãƒ¬ãƒ™ãƒ«é¸æŠç”»é¢ã®ç¢ºèª
      expect(find.text('é›£æ˜“åº¦é¸æŠ'), findsOneWidget);

      // åˆç´šã‚’é¸æŠ
      await tester.tap(find.text('åˆç´š (5Ã—5)'));
      await tester.pumpAndSettle();

      // ã‚²ãƒ¼ãƒ ç”»é¢ã®ç¢ºèª
      expect(find.text('æ‰‹æ•°'), findsOneWidget);
      expect(find.text('æ™‚é–“'), findsOneWidget);

      // ãƒ”ãƒ¼ã‚¹ãƒˆãƒ¬ã‚¤ã®ç¢ºèª
      expect(find.text('ãƒ”ãƒ¼ã‚¹'), findsOneWidget);

      // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ãƒ†ã‚¹ãƒˆ
      await tester.tap(find.byIcon(Icons.refresh));
      await tester.pumpAndSettle();
      
      if (find.text('ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ').evaluate().isNotEmpty) {
        await tester.tap(find.text('ãƒªã‚»ãƒƒãƒˆ'));
        await tester.pumpAndSettle();
      }

      // ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³ã®ãƒ†ã‚¹ãƒˆ
      await tester.tap(find.byIcon(Icons.pause));
      await tester.pumpAndSettle();

      expect(find.text('ä¸€æ™‚åœæ­¢'), findsOneWidget);
      
      await tester.tap(find.text('ã‚²ãƒ¼ãƒ å†é–‹'));
      await tester.pumpAndSettle();
    });

    testWidgets('settings flow', (tester) async {
      await StorageService.init();
      app.main();
      await tester.pumpAndSettle();

      // è¨­å®šç”»é¢ã¸ã®é·ç§»
      await tester.tap(find.text('è¨­å®š'));
      await tester.pumpAndSettle();

      expect(find.text('è¨­å®š'), findsOneWidget);

      // ã‚²ãƒ¼ãƒ è¨­å®šã®ç¢ºèª
      expect(find.text('ã‚²ãƒ¼ãƒ è¨­å®š'), findsOneWidget);
      expect(find.text('ã‚µã‚¦ãƒ³ãƒ‰'), findsOneWidget);
      expect(find.text('è§¦è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯'), findsOneWidget);

      // ã‚µã‚¦ãƒ³ãƒ‰è¨­å®šã®åˆ‡ã‚Šæ›¿ãˆ
      final soundSwitch = find.byType(Switch).first;
      await tester.tap(soundSwitch);
      await tester.pumpAndSettle();

      // æˆ»ã‚‹ãƒœã‚¿ãƒ³
      await tester.tap(find.byIcon(Icons.arrow_back));
      await tester.pumpAndSettle();

      expect(find.text('ãƒ–ãƒ¬ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã‚¹'), findsOneWidget);
    });

    testWidgets('help screen flow', (tester) async {
      await StorageService.init();
      app.main();
      await tester.pumpAndSettle();

      // ãƒ˜ãƒ«ãƒ—ç”»é¢ã¸ã®é·ç§»
      await tester.tap(find.text('ãƒ˜ãƒ«ãƒ—'));
      await tester.pumpAndSettle();

      expect(find.text('ãƒ˜ãƒ«ãƒ—'), findsOneWidget);
      expect(find.text('ã‚²ãƒ¼ãƒ ã®ç›®çš„'), findsOneWidget);
      expect(find.text('åŸºæœ¬æ“ä½œ'), findsOneWidget);

      // æˆ»ã‚‹ãƒœã‚¿ãƒ³
      await tester.tap(find.byIcon(Icons.arrow_back));
      await tester.pumpAndSettle();

      expect(find.text('ãƒ–ãƒ¬ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã‚¹'), findsOneWidget);
    });
  });
}

---

# test/test_helpers/test_utils.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:hive_flutter/hive_flutter.dart';
import 'package:brain_blocks/models/app_settings.dart';

class TestUtils {
  static Future<void> setupTestEnvironment() async {
    TestWidgetsFlutterBinding.ensureInitialized();
    
    // ãƒ†ã‚¹ãƒˆç”¨Hiveã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    Hive.init('./test/temp');
    Hive.registerAdapter(AppSettingsAdapter());
  }

  static Future<void> cleanupTestEnvironment() async {
    await Hive.deleteFromDisk();
  }
}

extension WidgetTesterExtensions on WidgetTester {
  Future<void> pumpUntilFound(
    Finder finder, {
    Duration timeout = const Duration(seconds: 10),
  }) async {
    bool timerDone = false;
    final timer = Timer(timeout, () => timerDone = true);
    
    while (timerDone != true) {
      await pump();
      
      if (any(finder)) {
        timer.cancel();
        return;
      }
      
      await Future.delayed(const Duration(milliseconds: 100));
    }
    
    timer.cancel();
    throw Exception('Timed out waiting for $finder');
  }
}

---

# test/test_helpers/mock_data.dart
import 'package:flutter/material.dart';
import 'package:brain_blocks/models/game_state.dart';
import 'package:brain_blocks/models/puzzle_piece.dart';
import 'package:brain_blocks/models/app_settings.dart';

class MockData {
  static GameState createMockGameState({
    GameDifficulty difficulty = GameDifficulty.easy,
    GameStatus status = GameStatus.playing,
  }) {
    final pieces = [
      PuzzlePiece(
        id: 'piece-1',
        cells: const [
          PiecePosition(0, 0),
          PiecePosition(1, 0),
        ],
        color: Colors.blue,
      ),
      PuzzlePiece(
        id: 'piece-2',
        cells: const [
          PiecePosition(0, 0),
          PiecePosition(0, 1),
          PiecePosition(1, 1),
        ],
        color: Colors.red,
      ),
      PuzzlePiece(
        id: 'piece-3',
        cells: const [
          PiecePosition(0, 0),
          PiecePosition(1, 0),
          PiecePosition(2, 0),
        ],
        color: Colors.green,
      ),
    ];

    return GameState(
      gameId: 'test-game',
      settings: GameSettings(
        difficulty: difficulty,
        mode: GameMode.unlimited,
      ),
      pieces: pieces,
      status: status,
    );
  }

  static AppSettings createMockAppSettings() {
    return AppSettings(
      soundEnabled: true,
      hapticsEnabled: true,
      colorBlindFriendly: false,
      defaultDifficulty: 'easy',
      adFree: false,
      personalizedAds: true,
      themeMode: 0,
    );
  }

  static List<PuzzlePiece> createMockPieces() {
    return [
      PuzzlePiece(
        id: 'mock-1',
        cells: const [PiecePosition(0, 0), PiecePosition(1, 0)],
        color: Colors.blue,
      ),
      PuzzlePiece(
        id: 'mock-2',
        cells: const [
          PiecePosition(0, 0),
          PiecePosition(0, 1),
          PiecePosition(1, 0),
        ],
        color: Colors.red,
      ),
    ];
  }
}

---

# lib/main_production.dart (æœ¬ç•ªç”¨çµ±åˆãƒ•ã‚¡ã‚¤ãƒ«)
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:flutter_localizations/flutter_localizations.dart';

// Services
import 'services/storage_service.dart';
import 'services/admob_service.dart';
import 'services/audio_service.dart';

// Providers
import 'providers/settings_providers.dart';

// Screens
import 'screens/home_screen.dart';

// Utils
import 'utils/error_handler.dart';
import 'utils/performance_monitor.dart';
import 'utils/app_lifecycle.dart';

// Localization
import 'l10n/app_localizations.dart';

void main() async {
  // åˆæœŸåŒ–
  WidgetsFlutterBinding.ensureInitialized();
  
  // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­å®š
  ErrorHandler.initialize();
  
  // ã‚·ã‚¹ãƒ†ãƒ UIè¨­å®š
  await _setupSystemUI();
  
  // ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–
  await _initializeServices();
  
  // ã‚¢ãƒ—ãƒªèµ·å‹•
  runApp(
    const ProviderScope(
      child: BrainBlocksApp(),
    ),
  );
}

Future<void> _setupSystemUI() async {
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼è¨­å®š
  SystemChrome.setSystemUIOverlayStyle(
    const SystemUiOverlayStyle(
      statusBarColor: Colors.transparent,
      statusBarIconBrightness: Brightness.light,
      systemNavigationBarColor: Colors.white,
      systemNavigationBarIconBrightness: Brightness.dark,
    ),
  );
  
  // ç”»é¢å‘ãè¨­å®š
  await SystemChrome.setPreferredOrientations([
    DeviceOrientation.portraitUp,
    DeviceOrientation.portraitDown,
  ]);
}

Future<void> _initializeServices() async {
  try {
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
    await StorageService.init();
    
    // AdMob
    await AdMobService.instance.initialize();
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ«ãƒ‰ã®ã¿ï¼‰
    PerformanceMonitor.instance.startMonitoring();
    
    print('å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ');
  } catch (e) {
    ErrorHandler.reportError('ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼', e);
  }
}

class BrainBlocksApp extends ConsumerStatefulWidget {
  const BrainBlocksApp({super.key});

  @override
  ConsumerState<BrainBlocksApp> createState() => _BrainBlocksAppState();
}

class _BrainBlocksAppState extends ConsumerState<BrainBlocksApp> {
  late AppLifecycleHandler _lifecycleHandler;

  @override
  void initState() {
    super.initState();
    
    // ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç›£è¦–
    _lifecycleHandler = AppLifecycleHandler(ref);
    WidgetsBinding.instance.addObserver(_lifecycleHandler);
    
    // éŸ³å£°ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–
    AudioService.instance.initialize(ref);
  }

  @override
  void dispose() {
    WidgetsBinding.instance.removeObserver(_lifecycleHandler);
    PerformanceMonitor.instance.stopMonitoring();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    final appSettings = ref.watch(appSettingsProvider);
    
    return MaterialApp(
      title: 'ãƒ–ãƒ¬ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã‚¹',
      debugShowCheckedModeBanner: false,
      
      // ãƒ†ãƒ¼ãƒè¨­å®š
      theme: _buildLightTheme(appSettings.colorBlindFriendly),
      darkTheme: _buildDarkTheme(appSettings.colorBlindFriendly),
      themeMode: appSettings.themeModeEnum,
      
      // å›½éš›åŒ–è¨­å®š
      localizationsDelegates: const [
        AppLocalizations.delegate,
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
        GlobalCupertinoLocalizations.delegate,
      ],
      supportedLocales: const [
        Locale('ja', 'JP'),
        Locale('en', 'US'),
        Locale('ko', 'KR'),
        Locale('zh', 'CN'),
        Locale('zh', 'TW'),
        Locale('es', 'ES'),
        Locale('pt', 'PT'),
        Locale('de', 'DE'),
        Locale('it', 'IT'),
      ],
      
      home: const HomeScreen(),
      
      // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      builder: (context, child) {
        ErrorWidget.builder = (FlutterErrorDetails details) {
          return Scaffold(
            body: Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const Icon(
                    Icons.error_outline,
                    size: 64,
                    color: Colors.red,
                  ),
                  const SizedBox(height: 16),
                  const Text(
                    'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
                    style: TextStyle(fontSize: 18),
                  ),
                  const SizedBox(height: 8),
                  ElevatedButton(
                    onPressed: () {
                      // ã‚¢ãƒ—ãƒªå†èµ·å‹•
                      SystemNavigator.pop();
                    },
                    child: const Text('ã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•'),
                  ),
                ],
              ),
            ),
          );
        };
        
        return child ?? const SizedBox.shrink();
      },
    );
  }

  ThemeData _buildLightTheme(bool colorBlindFriendly) {
    // ãƒ†ãƒ¼ãƒæ§‹ç¯‰ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå‰å›ã¨åŒã˜ï¼‰
    return ThemeData(
      useMaterial3: true,
      primarySwatch: Colors.blue,
      fontFamily: 'NotoSansJP',
    );
  }

  ThemeData _buildDarkTheme(bool colorBlindFriendly) {
    // ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒæ§‹ç¯‰ãƒ­ã‚¸ãƒƒã‚¯
    return ThemeData(
      useMaterial3: true,
      brightness: Brightness.dark,
      fontFamily: 'NotoSansJP',
    );
  }
}

---

# é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

## scripts/build_release.sh
#!/bin/bash

echo "ğŸš€ ãƒ–ãƒ¬ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã‚¹ ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰é–‹å§‹"

# ä¾å­˜é–¢ä¿‚ã®æ›´æ–°
echo "ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚’æ›´æ–°ä¸­..."
flutter pub get

# ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
echo "ğŸ”§ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­..."
flutter packages pub run build_runner build --delete-conflicting-outputs

# ã‚³ãƒ¼ãƒ‰è§£æ
echo "ğŸ” ã‚³ãƒ¼ãƒ‰è§£æä¸­..."
flutter analyze
if [ $? -ne 0 ]; then
    echo "âŒ ã‚³ãƒ¼ãƒ‰è§£æã§ã‚¨ãƒ©ãƒ¼ãŒç™ºè¦‹ã•ã‚Œã¾ã—ãŸ"
    exit 1
fi

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
echo "ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
flutter test
if [ $? -ne 0 ]; then
    echo "âŒ ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ"
    exit 1
fi

# Android APK ãƒ“ãƒ«ãƒ‰
echo "ğŸ¤– Android APK ãƒ“ãƒ«ãƒ‰ä¸­..."
flutter build apk --release --split-per-abi

# Android App Bundle ãƒ“ãƒ«ãƒ‰
echo "ğŸ“± Android App Bundle ãƒ“ãƒ«ãƒ‰ä¸­..."
flutter build appbundle --release

# iOS ãƒ“ãƒ«ãƒ‰ï¼ˆmacOSã®å ´åˆï¼‰
if [[ "$OSTYPE" == "darwin"* ]]; then
    echo "ğŸ iOS ãƒ“ãƒ«ãƒ‰ä¸­..."
    flutter build ios --release --no-codesign
fi

echo "âœ… ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰å®Œäº†ï¼"
echo "ğŸ“ å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: build/"

## scripts/setup_dev.sh  
#!/bin/bash

echo "ğŸ› ï¸ ãƒ–ãƒ¬ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã‚¹ é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"

# Flutter ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
flutter --version

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
echo "ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
flutter pub get

# ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
echo "ğŸ”§ åˆå›ã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­..."
flutter packages pub run build_runner build

# Android ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åŒæ„
echo "ğŸ“œ Android ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç¢ºèªä¸­..."
flutter doctor --android-licenses

# iOS è¨­å®šï¼ˆmacOSã®å ´åˆï¼‰
if [[ "$OSTYPE" == "darwin"* ]]; then
    echo "ğŸ iOS è¨­å®šä¸­..."
    cd ios && pod install && cd ..
fi

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆç¢ºèª
echo "ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆç¢ºèªä¸­..."
flutter doctor -v

echo "âœ… é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼"
echo "â–¶ï¸ é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•: flutter run"

import 'dart:async';

---

# README.md (æœ€çµ‚ç‰ˆ)
# ãƒ–ãƒ¬ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã‚¹ (BrainBlocks)

## ğŸ“ æ¦‚è¦
ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ”ãƒ¼ã‚¹ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ ã€‚æ­£æ–¹å½¢ã®ç›¤é¢ã«ãƒ”ãƒ¼ã‚¹ã‚’éš™é–“ãªãé…ç½®ã™ã‚‹ã“ã¨ãŒç›®çš„ã®è„³ãƒˆãƒ¬ã‚¢ãƒ—ãƒªã§ã™ã€‚

## âœ¨ ä¸»ãªæ©Ÿèƒ½
- **ãƒ©ãƒ³ãƒ€ãƒ ãƒ”ãƒ¼ã‚¹ç”Ÿæˆ**: æ¯å›ç•°ãªã‚‹ãƒ‘ã‚ºãƒ«ã§ç„¡é™ã«æ¥½ã—ã‚ã‚‹
- **3ã¤ã®é›£æ˜“åº¦**: 5Ã—5, 7Ã—7, 10Ã—10 ã®æ®µéšçš„ãªæŒ‘æˆ¦
- **ç›´æ„Ÿçš„æ“ä½œ**: ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã¨ã‚¿ãƒƒãƒ—å›è»¢
- **ãƒ’ãƒ³ãƒˆæ©Ÿèƒ½**: åºƒå‘Šè¦–è´ã§ãƒ’ãƒ³ãƒˆå–å¾—
- **çµ±è¨ˆæ©Ÿèƒ½**: ãƒ—ãƒ¬ã‚¤è¨˜éŒ²ã¨ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ ç®¡ç†
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: è‰²è¦šãƒãƒªã‚¢ãƒ•ãƒªãƒ¼å¯¾å¿œ
- **å¤šè¨€èªå¯¾å¿œ**: 9è¨€èªã‚µãƒãƒ¼ãƒˆ

## ğŸ› ï¸ æŠ€è¡“æ§‹æˆ
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Flutter 3.32 (beta)
- **çŠ¶æ…‹ç®¡ç†**: Riverpod 2.6
- **ãƒ­ãƒ¼ã‚«ãƒ«DB**: Hive
- **åºƒå‘Š**: Google AdMob
- **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: Lottie, Rive
- **å›½éš›åŒ–**: Flutter Intl

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ
```
lib/
â”œâ”€â”€ main.dart                    # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ models/                      # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ providers/                   # çŠ¶æ…‹ç®¡ç†
â”œâ”€â”€ services/                    # ã‚µãƒ¼ãƒ“ã‚¹å±¤
â”œâ”€â”€ screens/                     # ç”»é¢
â”œâ”€â”€ widgets/                     # ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ
â”œâ”€â”€ utils/                       # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â””â”€â”€ l10n/                       # å›½éš›åŒ–
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
1. **ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³**
   ```bash
   git clone [repository-url]
   cd brain_blocks
   ```

2. **é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
   ```bash
   chmod +x scripts/setup_dev.sh
   ./scripts/setup_dev.sh
   ```

3. **é–‹ç™ºå®Ÿè¡Œ**
   ```bash
   flutter run
   ```

## ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# å˜ä½“ãƒ†ã‚¹ãƒˆ
flutter test

# ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
flutter test test/widget/

# çµ±åˆãƒ†ã‚¹ãƒˆ
flutter test integration_test/
```

## ğŸ“± ãƒ“ãƒ«ãƒ‰æ–¹æ³•
```bash
# ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰
chmod +x scripts/build_release.sh
./scripts/build_release.sh

# å€‹åˆ¥ãƒ“ãƒ«ãƒ‰
flutter build apk --release
flutter build appbundle --release
flutter build ios --release
```

## ğŸŒŸ ä»Šå¾Œã®äºˆå®š
- V2: å¤šè§’å½¢ç›¤é¢ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ©ãƒ³ã‚­ãƒ³ã‚°
- V3: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”Ÿæˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€PvPå¯¾æˆ¦
- ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å±•é–‹

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
MIT License

---

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€æŠ€è¡“çš„ãªå®Œæˆåº¦ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®ä¸¡æ–¹ã‚’é‡è¦–ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆã«ã‚ˆã‚Šã€æ©Ÿèƒ½è¿½åŠ ã‚„ä¿å®ˆãŒå®¹æ˜“ãªæ§‹é€ ã¨ãªã£ã¦ã„ã¾ã™ã€‚